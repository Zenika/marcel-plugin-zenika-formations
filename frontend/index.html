<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <script src="./marcel.js"></script>
</head>

<body>

  <ol id="content">

  </ol>

  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
    }
  </style>

  <script>
    class ZenikaFormations extends Marcel.Plugin {
      constructor() {
        super({
          defaultProps: {
            agency: ''
          },
        })

        this.formationList = document.getElementById('content');
        this.urlFormationList = "http://localhost:8080/api/public/planned-sessions"
      }

      getAllSessionsInAgency(agency) {
        return fetch(this.urlFormationList)
          .then(response => response.json())
          .then(formJson => formJson.plannedSessions.filter(e => e.agencyName === agency))
      }

      displayAllFuturSessions(agency) {
        this.getAllSessionsInAgency(agency)
          .then(sessions => {
            sessions.forEach(e => {
              const formation = document.createElement("li")
              formation.innerHTML = "Formation " + e.trainingTitle + ", " + e.trainingSubTitle + " | " + 
                  e.startDate + " at " + e.agencyName
              this.formationList.appendChild(formation)
            })
          })
      }

      propsDidChange(prevProps) {
        const { agency } = this.props
        if (agency !== prevProps.agency) {
          this.displayAllFuturSessions(agency)
        }
      }

      render() {
        const { agency } = this.props
      }
    }

    const instance = new ZenikaFormations()

    Marcel.Debug.changeProps({agency: "Nantes"})
  </script>
</body>

</html>